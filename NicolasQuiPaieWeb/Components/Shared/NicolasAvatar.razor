@using NicolasQuiPaieData.DTOs

@if (User != null)
{
    <div class="nicolas-avatar-component">
        <div class="nicolas-avatar @GetAvatarClass()">
            @if (!string.IsNullOrEmpty(User.ProfileImageUrl))
            {
                <img src="@User.ProfileImageUrl" alt="@User.DisplayName" class="nicolas-avatar-img @GetAvatarBorderClass()" />
            }
            else
            {
                <div class="nicolas-avatar-img nicolas-avatar-default @GetAvatarBorderClass()">
                    @GetInitials()
                </div>
            }
            <div class="nicolas-avatar-badge @GetBadgeClass()">
                @GetLevelEmoji()
            </div>
        </div>
        
        @if (ShowInfo)
        {
            <div class="avatar-info">
                <div class="avatar-name">@User.DisplayName</div>
                <div class="avatar-level @GetLevelClass()">@GetLevelText()</div>
            </div>
        }
    </div>
}

@code {
    [Parameter] public UserDto? User { get; set; }
    [Parameter] public bool ShowInfo { get; set; } = true;
    [Parameter] public string Size { get; set; } = "medium"; // small, medium, large

    private string GetInitials()
    {
        if (User?.DisplayName == null) return "N";
        
        var parts = User.DisplayName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length >= 2)
        {
            return $"{parts[0][0]}{parts[1][0]}".ToUpper();
        }
        return User.DisplayName.Length > 0 ? User.DisplayName[0].ToString().ToUpper() : "N";
    }

    private string GetLevelEmoji()
    {
        return User?.ContributionLevel switch
        {
            ContributionLevel.PetitNicolas => "??",
            ContributionLevel.GrosMoyenNicolas => "??", 
            ContributionLevel.GrosNicolas => "??", 
            ContributionLevel.NicolasSupreme => "??",
            _ => "??"
        };
    }

    private string GetLevelText()
    {
        return User?.ContributionLevel switch
        {
            ContributionLevel.PetitNicolas => "Petit Nicolas",
            ContributionLevel.GrosMoyenNicolas => "Moyen Nicolas",
            ContributionLevel.GrosNicolas => "Gros Nicolas",
            ContributionLevel.NicolasSupreme => "Nicolas Suprême", 
            _ => "Petit Nicolas"
        };
    }

    private string GetAvatarClass()
    {
        return Size switch
        {
            "small" => "nicolas-avatar-sm",
            "large" => "nicolas-avatar-lg", 
            _ => "nicolas-avatar-md"
        };
    }

    private string GetAvatarBorderClass()
    {
        return User?.ContributionLevel switch
        {
            ContributionLevel.PetitNicolas => "nicolas-avatar-petit",
            ContributionLevel.GrosMoyenNicolas => "nicolas-avatar-moyen",
            ContributionLevel.GrosNicolas => "nicolas-avatar-gros",
            ContributionLevel.NicolasSupreme => "nicolas-avatar-supreme",
            _ => "nicolas-avatar-petit"
        };
    }

    private string GetBadgeClass()
    {
        return User?.ContributionLevel switch
        {
            ContributionLevel.PetitNicolas => "nicolas-level-badge-petit",
            ContributionLevel.GrosMoyenNicolas => "nicolas-level-badge-moyen",
            ContributionLevel.GrosNicolas => "nicolas-level-badge-gros", 
            ContributionLevel.NicolasSupreme => "nicolas-level-badge-supreme",
            _ => "nicolas-level-badge-petit"
        };
    }

    private string GetLevelClass()
    {
        return User?.ContributionLevel switch
        {
            ContributionLevel.PetitNicolas => "text-secondary",
            ContributionLevel.GrosMoyenNicolas => "text-primary",
            ContributionLevel.GrosNicolas => "text-info",
            ContributionLevel.NicolasSupreme => "text-warning",
            _ => "text-secondary"
        };
    }
}